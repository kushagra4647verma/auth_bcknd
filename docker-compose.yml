networks:
  sipzy-network:
    driver: bridge

services:
  # ============================================
  # NGINX REVERSE PROXY (Main Entry Point)
  # ============================================
  nginx:
    image: nginx:alpine
    container_name: nginx-proxy
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - /etc/letsencrypt:/etc/letsencrypt:ro
      - /var/www/certbot:/var/www/certbot:ro
    depends_on:
      - auth_service
      - restaurant-onboarding-gateway
    networks:
      - sipzy-network
    restart: always

  # ============================================
  # RESTAURANT ONBOARDING SERVICES (restaurant_onboarding/)
  # ============================================

  restaurant-onboarding-gateway:
    build: ./restaurant_onboarding/gateway
    container_name: restaurant-onboarding-gateway
    expose:
      - "3000"
    env_file:
      - ./restaurant_onboarding/.env
    environment:
      - RESTAURANT_SERVICE_URL=http://onboarding-restaurant-service:5001
      - BEVERAGE_SERVICE_URL=http://onboarding-beverage-service:5002
      - EVENT_SERVICE_URL=http://onboarding-event-service:5003
      - API_GATEWAY_PORT=3000
    depends_on:
      - onboarding-restaurant-service
      - onboarding-beverage-service
      - onboarding-event-service
    networks:
      - sipzy-network
    restart: always

  onboarding-restaurant-service:
    build: ./restaurant_onboarding/services/restaurant
    container_name: onboarding-restaurant-service
    expose:
      - "5001"
    env_file:
      - ./restaurant_onboarding/.env
    environment:
      - PORT=5001
    networks:
      - sipzy-network
    restart: always

  onboarding-beverage-service:
    build: ./restaurant_onboarding/services/beverage
    container_name: onboarding-beverage-service
    expose:
      - "5002"
    env_file:
      - ./restaurant_onboarding/.env
    environment:
      - PORT=5002
    networks:
      - sipzy-network
    restart: always

  onboarding-event-service:
    build: ./restaurant_onboarding/services/event
    container_name: onboarding-event-service
    expose:
      - "5003"
    env_file:
      - ./restaurant_onboarding/.env
    environment:
      - PORT=5003
    networks:
      - sipzy-network
    restart: always

  # ============================================
  # AUTH SERVICE
  # ============================================
  auth_service:
    build: ./auth_service
    container_name: auth_service
    expose:
      - "5000"
    env_file:
      - ./.env
    environment:
      - PORT=5000
    networks:
      - sipzy-network
    restart: always
